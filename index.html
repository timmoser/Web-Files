<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Washington Weather</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }

    ul,
    li {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    li {
      margin: 20px;
      max-width: 420px;
      border: 1px solid rgb(220, 220, 220);
      box-shadow: 0 0 15px rgb(216, 216, 216);
    }

    .img {
      position: relative;
      height: 0;
      width: 100%;
      padding-top: 69.6%;
      overflow: hidden;
    }

    .img img {
      position: absolute;
      top: -35px;
      left: 0;
      width: 100%;
    }
  </style>
</head>
<body>
    <ul id="imageList"></ul>

    <script>
        async function fetchImages() {
            const listContainer = document.getElementById('imageList');

            // Get current date and time in Seattle
            const currentTimeSeattle = new Date();
            const seattleOffset = -7; // Pacific Time Zone (PT) offset from UTC
            const currentDateTimeUTC = currentTimeSeattle.getTime() + (seattleOffset * 3600 * 1000); // Convert to UTC
            const currentDay = currentTimeSeattle.getUTCDate();
            
            // Loop through next 3 days
            for (let dayOffset = 0; dayOffset < 3; dayOffset++) {
                const currentDate = new Date(currentDateTimeUTC + (dayOffset * 24 * 3600 * 1000));
                const year = currentDate.getUTCFullYear();
                const month = String(currentDate.getUTCMonth() + 1).padStart(2, '0');
                const day = String(currentDate.getUTCDate()).padStart(2, '0');
                
                // Loop through 8 hours of the day (0, 3, 6, 9, 12, 15, 18, 21)
                for (let hour = 0; hour < 24; hour += 3) {
                    const hourString = String(hour).padStart(2, '0');
                    const imageUrl = `http://graphical.weather.gov/images/washington/dynamic/Sky_${year}${month}${day}${hourString}_washington.png`;

                    // Check if image exists
                    const imageExists = await doesImageExist(imageUrl);
                    if (!imageExists) continue;

                    const liElement = document.createElement('li');
                    const imgDiv = document.createElement('div');
                    imgDiv.classList.add('img');
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;

                    const localTime = currentDate.toLocaleString();
                    const h2Element = document.createElement('h2');
                    h2Element.textContent = `Date and Time (Seattle): ${localTime}`;

                    imgDiv.appendChild(imgElement);
                    liElement.appendChild(imgDiv);
                    liElement.appendChild(h2Element);
                    listContainer.appendChild(liElement);
                }
            }
        }

        // Function to check if an image exists
        async function doesImageExist(url) {
            try {
                const response = await fetch(url);
                return response.ok;
            } catch (error) {
                console.error('Error checking image existence:', error);
                return false;
            }
        }

        window.onload = fetchImages;
    </script>
</body>
</html>
